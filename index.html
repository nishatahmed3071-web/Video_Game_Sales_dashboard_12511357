<script>
        let globalData = [];
        let filteredData = [];

        // Load CSV data from GitHub
        function loadCSVData() {
            const csvUrl = 'https://raw.githubusercontent.com/nishatahmed3071-web/Video_Game_Sales_dashboard_12511357/main/Video_Games_Sales_as_at_22_Dec_2016.csv';
            
            // Show loading message
            document.querySelector('.stats-bar').innerHTML = '<div class="loading">Loading data...</div>';
            
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Process the data
                    globalData = results.data.filter(row => {
                        // Filter out rows with missing essential data
                        return row.Name && 
                               row.Genre && 
                               row.Platform && 
                               row.Year_of_Release &&
                               !isNaN(row.Year_of_Release) &&
                               row.Global_Sales !== null &&
                               row.Global_Sales !== undefined;
                    }).map(row => ({
                        Name: row.Name,
                        Platform: row.Platform,
                        Year_of_Release: parseInt(row.Year_of_Release),
                        Genre: row.Genre,
                        NA_Sales: parseFloat(row.NA_Sales) || 0,
                        EU_Sales: parseFloat(row.EU_Sales) || 0,
                        JP_Sales: parseFloat(row.JP_Sales) || 0,
                        Other_Sales: parseFloat(row.Other_Sales) || 0,
                        Global_Sales: parseFloat(row.Global_Sales) || 0
                    }));
                    
                    filteredData = [...globalData];
                    
                    // Update year range based on actual data
                    const years = globalData.map(d => d.Year_of_Release);
                    const minYear = Math.min(...years);
                    const maxYear = Math.max(...years);
                    
                    const yearRange = document.getElementById('yearRange');
                    yearRange.min = minYear;
                    yearRange.max = maxYear;
                    yearRange.value = maxYear;
                    document.getElementById('yearDisplay').textContent = `${minYear} - ${maxYear}`;
                    
                    // Restore stats bar HTML
                    document.querySelector('.stats-bar').innerHTML = `
                        <div class="stat-card">
                            <h3 id="totalGames">-</h3>
                            <p>Total Games</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="totalSales">-</h3>
                            <p>Global Sales (M)</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="avgSales">-</h3>
                            <p>Avg Sales (M)</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="topGenre">-</h3>
                            <p>Top Genre</p>
                        </div>
                    `;
                    
                    // Initialize dashboard
                    populateFilters();
                    updateDashboard();
                },
                error: function(error) {
                    console.error('Error loading CSV:', error);
                    document.querySelector('.stats-bar').innerHTML = '<div class="loading" style="color: #d9534f;">Error loading data. Please check the CSV file URL.</div>';
                }
            });
        }

        // Initialize with CSV data
        loadCSVData();
